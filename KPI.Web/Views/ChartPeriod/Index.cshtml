@model KPI.Model.ViewModel.ChartVM
@using KPI.Model.helpers;
@using MvcBreadCrumbs
@{
    ViewBag.Title = "Chart";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var datasets = ViewBag.Datasets as int?[];
    var dataremarks = (List<KPI.Model.ViewModel.Dataremark>)ViewBag.Dataremarks;
    var labels = ViewBag.Labels as string[];
    var label = ViewBag.Label as string;
    var kpiname = ViewBag.KPIName as string;
    var period = ViewBag.Period as string;
    var kpilevelcode = ViewBag.KPILevelCode as string;
    var statusfavorite = ViewBag.StatusFavorite as string;
    var url = ViewBag.Url as string;
}
@Html.Raw(BreadCrumb.Display())
@section Scripts{
    <script type="text/javascript">

        var labelString;
        if ("@period" === "W") {
            labelString = " Weeks in year ";
            $("#searchWeek").show();
        }
        if ("@period" === "M") {
            labelString = "Months in year";
              $("#searchMonth").show();
        }
        if ("@period" === "Q") {
            labelString = "Quarters in year";
              $("#searchQuarter").show();
        }
        if ("@period" === "Y") {
            labelString = "Years";
              $("#searchYear").show();
        }
        var datasets =@Html.Raw(Json.Encode(datasets));
         if (datasets.length === 0) {
                   Swal.fire({
                        title: 'There is no data!',
                        //text: 'Error',
                        type: 'error'
                    });
             }
        var labels =@Html.Raw(Json.Encode(labels));
        var dataremarks =@Html.Raw(Json.Encode(dataremarks));
    var label = "@label";
        var period = "@period";
         var kpilevelcode = "@kpilevelcode";
        $(function () {

            if (period === "W") {
            //Thêm tiêu đề cho tr:first-child th
                $("#tblkpi tr:first-child").append("<th>Week</th>");

            //Thêm dữ liệu tr từ tuần 1 đến tuần còn lại
            $.each(labels, function (key, item) {
                $("#tblkpi tr:first-child").append("<th >" + item + "</th>");
            });

            //Thêm tiêu đề cho tr:nth-child(2) th
            $("#tblkpi tr:nth-child(2)").append("<th >Percentage</th>");

             //Thêm dữ liệu cho tr:nth-child(2) td
            $.each(dataremarks, function (key, item) {
                $("#tblkpi tr:nth-child(2)").append("<td data-id='"+item.ID+"' onclick='return chartperiodController.Remark("+item.ID+")' >" + item.Value + "</td>");
            });

        var lastRemark = dataremarks[dataremarks.length - 1];
                console.log(lastRemark.ID)
                $('#lastRemark').val(lastRemark.Remark);
                $('.lastRemark').text(lastRemark.ID);
                $('.lastRemarkLabel').text("Week " + lastRemark.Week + " : ");
            $("#fromDateEndDate").show();
        }
    else if (period === "M") {
            //Thêm tiêu đề cho tr:first-child th
            $("#tblkpi tr:first-child").append("<th >Month</th>");

            //Thêm dữ liệu tr từ tháng 1 đến tháng còn lại
            $.each(labels, function (key, item) {
                $("#tblkpi tr:first-child").append("<th >" + item + "</th>");
            });

            //Thêm tiêu đề cho tr:nth-child(2) th
                $("#tblkpi tr:nth-child(2)").append("<th >Percentage</th>");

            //Thêm dữ liệu cho tr:nth-child(2) td
            $.each(dataremarks, function (key, item) {
                $("#tblkpi tr:nth-child(2)").append("<td data-id='"+item.ID+"' onclick='return chartperiodController.Remark("+item.ID+")'  >" + item.Value + "</td>");
            });

             var lastRemark = dataremarks[dataremarks.length - 1];

             $('#lastRemark').val(lastRemark.Remark);
            $('.lastRemarkLabel').text("Month " + lastRemark.Month + " : ");
            //Hiển thị ngày tháng dưới chartjs
            $("#fromDateEndDateM").show();
        }
    else if (period=== "Q") {
             //Thêm tiêu đề cho tr:first-child th
            $("#tblkpi tr:first-child").append("<th >Quarter</th>");

            //Thêm dữ liệu tr từ quý 1 đến tháng còn lại
            $.each(labels, function (key, item) {
                $("#tblkpi tr:first-child").append("<th >" + item + "</th>");
        });

            //Thêm tiêu đề cho tr:nth-child(2) th
            $("#tblkpi tr:nth-child(2)").append("<th >Percentage</th>");

            //Thêm dữ liệu cho tr:nth-child(2) td
            $.each(dataremarks, function (key, item) {
                $("#tblkpi tr:nth-child(2)").append("<td data-id='"+item.ID+"' onclick='return chartperiodController.Remark("+item.ID+")'>" + item.Value + "</td>");
            });

            var lastRemark = dataremarks[dataremarks.length - 1];
             $('#lastRemark').val(lastRemark.Remark);
            $('.lastRemarkLabel').text("Quarter " + lastRemark.Quater + " : ");

            //Hiển thị ngày tháng dưới chartjs
            $("#fromDateEndDateQ").show();

        }
    else if (period === "Y") {

             //Thêm tiêu đề cho tr:first-child th
            $("#tblkpi tr:first-child").append("<th >Year</th>");

            //Thêm dữ liệu tr từ quý 1 đến tháng còn lại
            $.each(labels, function (key, item) {
                $("#tblkpi tr:first-child").append("<th >" + item + "</th>");
            });

            //Thêm tiêu đề cho tr:nth-child(2) th
            $("#tblkpi tr:nth-child(2)").append("<th >Percentage</th>");

             //Thêm dữ liệu cho tr:nth-child(2) td
            $.each(dataremarks, function (key, item) {
                $("#tblkpi tr:nth-child(2)").append("<td data-id='"+item.ID+"' onclick='return chartperiodController.Remark("+item.ID+")'  >" + item.Value + "</td>");
            });
             var lastRemark = dataremarks[dataremarks.length - 1];
             $('#lastRemark').val(lastRemark.Remark);
            $('.lastRemarkLabel').text("Year " + lastRemark.Year + " : " );

        }

            var ctx = document.getElementById('lineChart').getContext('2d');

            Chart.defaults.global.defaultFontSize = 14;
            var myChart = new Chart(ctx, {
                type:'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: datasets,
                        fill: "#ffffff",
                        borderWidth: 2,
                        borderColor: "#d81b60",
                        backgroundColor: "#d81b60",
                        pointBackgroundColor: "#d81b60"
                    }]
                },
                options: {
                    elements: {
                    point:{
                        radius: 0
                    }
                },
                 layout: {
                padding: {
                    left: 0,
                    right: 20,
                    top: 0,
                    bottom: 0
                }
            },
             title: {
            display: true,
                text: "@label - @kpiname",
                fontSize: 16,
                fontColor: 'black'

            },
            plugins: {
                datalabels: {
                    display: false
                }
            },
            elements: {
                line: {
                    tension: 0.2
                }
            },
            scales: {
                yAxes: [{
                    display: true,
                    position: "left",
                    ticks: {
                        beginAtZero: true,
                        padding: 10,
                        fontSize: 14,
                        max: 100
                    },
                     scaleLabel: {
                        display: true,
                         labelString: 'Percentage',
                      }
                }],
                xAxes: [{
                    gridLines: {
                        display: true,
                        tickMarkLength: 8
                    },
                    ticks: {
                        fontSize: 14,
                    }
                    ,
                     scaleLabel: {
                        display: true,
                        labelString: labelString
                      }
                }]
            },
            animation: {
                onComplete() {
                    var chartInstance = this.chart,
                        ctx = chartInstance.ctx;

                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    this.data.datasets.forEach(function (dataset, i) {
                        var meta = chartInstance.controller.getDatasetMeta(i);
                        meta.data.forEach(function (bar, index) {
                            var data = dataset.data[index];
                            ctx.fillText(data, bar._model.x, bar._model.y-5);
                        });
                    });
                }
            },
            poitDot: true
        }
    });
        chartperiodController.init();
});
var chartperiodlConfig = {
    pageSize: 6,
    pageIndex: 1
};
var chartperiodController = {
    init() {

        chartperiodController.loadDataComment();
        chartperiodController.loadDataProvide();
         chartperiodController.registerEvent();
    },
    registerEvent() {
        $("#tblkpi tr:nth-child(2) td").dblclick(function () {
            $('#modal-group-comment-data').modal('show');
        });
        $('#lastRemark').off('keypress').on('keypress', function (e) {
            if (e.keyCode === 13) {
                chartperiodController.UpdateRemark();
            }
        });
        var year = chartperiodController.getUrlParameter('year');
        var start = chartperiodController.getUrlParameter('start');
        var end = chartperiodController.getUrlParameter('end');
         var period = chartperiodController.getUrlParameter('period');
        if (year == "0" && start === "0" && end === "0") {

            var d = new Date();
            var currenyear = d.getFullYear();
            year = currenyear;
            start = 1;
            end = 52;
            if (period === "W") {
                $("#weekOfYear").val(currenyear);
                $("#startWeek").val(1);
                $("#endWeek").val(52);

            }

            if (period === "M") {
                $("#monthOfYear").val(currenyear);
                $("#startMonth").val(1);
                $("#endMonth").val(12);
                 year = currenyear;
                    start = 1;
                    end = 12;
            }
            if (period === "Q") {
                $("#quarterOfYear").val(currenyear);
                $("#startQuarter").val(1);
                $("#endQuarter").val(4);
                 year = currenyear;
                    start = 1;
                    end = 4;
            }
            if (period === "Y") {
                $("#weekOfYear").val(currenyear);
                $("#startYear").val(currenyear);
                $("#endYear").val(currenyear);
                 year = currenyear;
                start = currenyear;
                end = currenyear;
            }
        }
        else {
            $("#weekOfYear").val(year);
            $("#startWeek").val(start);
            $("#endWeek").val(end);

            $("#monthOfYear").val(year);
            $("#startMonth").val(start);
            $("#endMonth").val(end);


            $("#quarterOfYear").val(year);
            $("#startQuarter").val(start);
            $("#endQuarter").val(end);

            $("#weekOfYear").val(year);
            $("#startYear").val(start);
            $("#endYear").val(end);

        }
       
        if (Number($('#weekOfYear').val()) !== 0) {
           var year = year;
            var startWeek = start;
            var fromDate = new Date("Jan 01, " + year + " 01:00:00");
            var fw = fromDate.getTime() + 604800000 * (startWeek - 1);

            var fromDayStartWeek = new Date(fw);
            var fromDayStartW = (fromDayStartWeek.getMonth() + 1) + ' - ' + fromDayStartWeek.getDate() + ' - ' + fromDayStartWeek.getFullYear();

            var endDayStartWeek = new Date(fw + 518400000);
            var endDayStartW = (endDayStartWeek.getMonth() + 1) + ' - ' + endDayStartWeek.getDate() + ' - ' + endDayStartWeek.getFullYear();

            var endWeek = end;
            var ed = new Date("Jan 01, " + year + " 01:00:00");
            var ew = ed.getTime() + 604800000 * (endWeek - 1);

            var fromDayEndWeek = new Date(ew);
            var fromDayEndW = (fromDayEndWeek.getMonth()+1) + ' - ' + fromDayEndWeek.getDate() + ' - ' + fromDayEndWeek.getFullYear();


            var endDayEndWeek = new Date(ew + 518400000);
            var endDayEndW = (endDayEndWeek.getMonth() + 1) + ' - ' + endDayEndWeek.getDate() + ' - ' + endDayEndWeek.getFullYear();

              $("#fromDateEndDate .fromDayOfWeek").text('Week '+start+' ( from ' + fromDayStartW + ' to ' + endDayStartW +' )');
              $("#fromDateEndDate .endDayOfWeek").text(' -> Week '+end+' ( from ' + fromDayEndW + ' to ' + endDayEndW+' )');

        }
        if (Number($('#monthOfYear').val()) !== 0) {
            var now = new Date(year,start,1);
            var prevMonthLastDate = new Date(now.getFullYear(), now.getMonth(), 0);
            var prevMonthFirstDate = new Date(now.getFullYear() - (now.getMonth() > 0 ? 0 : 1), (now.getMonth() - 1 + 12) % 12, 1);

            var formatDateComponent = function(dateComponent) {
              return (dateComponent < 10 ? '0' : '') + dateComponent;
            };

            var now2 = new Date(year,end,1);
            var prevMonthLastDate2 = new Date(now2.getFullYear(), now2.getMonth(), 0);
            var prevMonthFirstDate2 = new Date(now2.getFullYear() - (now2.getMonth() > 0 ? 0 : 1), (now2.getMonth() - 1 + 12) % 12, 1);

            var formatDateComponent = function(dateComponent) {
              return (dateComponent < 10 ? '0' : '') + dateComponent;
            };

            var formatDate = function(date) {
              return formatDateComponent(date.getMonth() + 1) + ' - ' + formatDateComponent(date.getDate()) + ' - ' + date.getFullYear();
            };


              $("#fromDateEndDateM .fromDayOfMonth").text('Month '+start+' ( from ' + formatDate(prevMonthFirstDate) + ' to ' + formatDate(prevMonthLastDate) +' )');
              $("#fromDateEndDateM .endDayOfMonth").text(' -> Month '+end+' ( from ' + formatDate(prevMonthFirstDate2) + ' to ' + formatDate(prevMonthLastDate2)+' )');
        }

         if (Number($('#quarterOfYear').val()) !== 0) {
            var startQ = new Date(year,start*3-3,1);
             var endQ = new Date(year, start * 3, 0);

              var startQ2 = new Date(year,end*3-3,1);
             var endQ2 = new Date(year, end * 3, 0);
               var formatDateComponent = function(dateComponent) {
              return (dateComponent < 10 ? '0' : '') + dateComponent;
             };

            var formatDate = function(date) {
              return formatDateComponent(date.getMonth() + 1) + ' - ' + formatDateComponent(date.getDate()) + ' - ' + date.getFullYear();
            };
            //var formatDate = function(date) {
            //  return (date.getMonth() + 1) + '/' + (date.getDate()) + '/' + date.getFullYear();
            //};
              $("#fromDateEndDateQ .fromDayOfQuarter").text('Quarter '+start+' ( from ' + formatDate(startQ) + ' to ' + formatDate(endQ) +' )');
              $("#fromDateEndDateQ .endDayOfQuarter").text(' -> Quarter '+end+' ( from ' + formatDate(startQ2) + ' to ' + formatDate(endQ2)+' )');

        }
        $('#btnClearSearch').off('click').on('click', function () {
        var kpilevelcode = chartperiodController.getUrlParameter('kpilevelcode');
        var period = chartperiodController.getUrlParameter('period');
           window.location.href = "/ChartPeriod/?kpilevelcode="+kpilevelcode+"&period="+period+"&year=0&start=0&end=0)";

        })

        $('#comment').unbind('keypress').on('keypress', function (e) {
            if (e.keyCode == 13) {

                chartperiodController.addData();
                $('#boxComments').empty();
                chartperiodController.loadDataComment();
            }

        });
        $('#btnComment').off('click').on('click', function (e) {
            if (e.keyCode === 13) {

                chartperiodController.addData();
                $('#boxComments').empty();
                chartperiodController.loadDataComment();

            }
        });
         $('#btnLike').off('click').on('click', function (e) {

                chartperiodController.addFavourite();
          });
         $('#endWeek').off('change').on('change', function (e) {
             chartperiodController.search();

         });
         $('#endMonth').off('change').on('change', function (e) {
             chartperiodController.search();

         });
         $('#endQuarter').off('change').on('change', function (e) {
             chartperiodController.search();

         });
         $('#endYear').off('change').on('change', function (e) {
             chartperiodController.search();
         });
        $('#btnCompare').off('click').on('click', function (e) {
             chartperiodController.loadDataProvide();

         });
    },
    search() {
          if ("@period" === "W")
                    window.location.href = "/ChartPeriod/?kpilevelcode=@kpilevelcode&period=@period&year="+Number($("#weekOfYear").val())+"&start=" + Number($("#startWeek").val()) + "&end=" + Number($("#endWeek").val());

         if ("@period" === "M")
                   window.location.href = "/ChartPeriod/?kpilevelcode=@kpilevelcode&period=@period&year="+Number($("#monthOfYear").val())+"&start=" + Number($("#startMonth").val()) + "&end=" + Number($("#endMonth").val());

         if ("@period" === "Q")
                  window.location.href = "/ChartPeriod/?kpilevelcode=@kpilevelcode&period=@period&year="+Number($("#quarterOfYear").val())+"&start=" + Number($("#startQuarter").val()) + "&end=" + Number($("#endQuarter").val());

          if ("@period" === "Y")
                   window.location.href = "/ChartPeriod/?kpilevelcode=@kpilevelcode&period=@period&year=0&start=" + Number($("#startYear").val()) + "&end=" + Number($("#endYear").val());
    },
    addData() {
        if ($('#comment').val() == "") {
            Swal.fire({
                title: 'Warning!',
                text: 'Please enter message!',
                type: 'warning',
                confirmButtonText: 'OK'
            });
            return;
        }
        var mObj = {
            KPILevelCode: "@kpilevelcode@period",
            CommentMsg: $('#comment').val(),
            UserID: Number($("#user").data('userid'))
        };
        $.ajax({
            url: "/ChartPeriod/AddComment",
            data: JSON.stringify(mObj),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                $('#comment').val("");
                chartperiodController.loadDataComment();
            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    },
    addDataHistory() {
        if ($('#comment').val() == "") {
            Swal.fire({
                title: 'Warning!',
                text: 'Please enter message!',
                type: 'warning',
                confirmButtonText: 'OK'
            });
            return;
        }
        var mObj = {
            UserID: Number($("#user").data('userid'))
        };
        $.ajax({
            url: "/ChartPeriod/AddCommentHistory",
            data: JSON.stringify(mObj),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                $('#comment').val("");
                chartperiodController.loadDataComment();
            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    },
    getUrlParameter: function(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
        }
    },
    addFavourite() {
        var UserID = $('#user').data('userid');
        if (UserID === 0 || UserID === "" || UserID === undefined) {
            Swal.fire({
                title: 'Warning!',
                text: 'Error!',
                type: 'warning',
                confirmButtonText: 'OK'
            });
            return;
        }
        var mObj = {
            KPILevelCode: "@kpilevelcode",
            Period: "@period",
            UserID: UserID,
        };
        $.ajax({
            url: "/ChartPeriod/AddFavourite",
            data: JSON.stringify(mObj),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                //
                Swal.fire({
                    title: 'success!',
                    text: 'Add success!',
                    type: 'success',
                    confirmButtonText: 'OK'
                });
            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    },
    Remark(id) {
        $.post("/ChartPeriod/Remark", { dataid: id }, function (result) {
            console.log(result);
            //$("#remark").val(result.Remark);
                $(".lastRemark").text(id);

             $("#textarea-remark").toggle(500);
             if (result.Week != undefined) {
                 $("#lastRemark").val(result.Remark);
                 $("#remark").val("Week " + result.Week + " : " + result.Remark);
                $('.lastRemarkLabel').text("Week " + result.Week + " : ");

             }
             if (result.Month != undefined) {
                 $("#lastRemark").val(result.Remark);
                 $("#remark").val("Month " + result.Month + " : " + result.Remark);
                $('.lastRemarkLabel').text("Month " + result.Month + " : ");


             }
             if (result.Quater != undefined) {
                 $("#lastRemark").val(result.Remark);
                 $("#remark").val("Quarter " + result.Quater + " : " + result.Remark);
                $('.lastRemarkLabel').text("Quarter " + result.Quater + " : " );

             }
             if (result.Year != undefined) {
                 $("#lastRemark").val(result.Remark);
                 $("#remark").val("Year " + result.Year + " : " + result.Remark);
                $('.lastRemarkLabel').text("Year " + result.Year + " : ");

             }
        });
    },
    UpdateRemark() {
        var remark = $('#lastRemark').val();
        var dataid = Number($('.lastRemark').text());
         $.post("/ChartPeriod/UpdateRemark", { dataid:dataid , remark:remark }, function (result) {
            Swal.fire({
                title: 'Success!',
                text: 'Add successfully!',
                type: 'success',
                confirmButtonText: 'OK'
            });
        });
    } ,
    loadDataProvide() {
        var obj="@kpilevelcode,@period";
          $.ajax({
            url: "/ChartPeriod/LoadDataProvide/?obj="+obj,
            type: "POST",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (data) {
        console.log(data.listCompare);
             var count = 1;
             var html = '';
             var template = $('#tblcomparechart-template').html();
             $.each(data.listCompare, function (i, item) {
                 html += Mustache.render(template, {
                     No: count,
                     KPILevelCode: item.KPILevelCode,
                     LevelNumber:item.LevelNumber,
                     Area: item.Area,
                     Status: item.Status==true?'<span class="label label-success">visible</span>' : '<span class="label bg-danger">not visible</span>'
                 });
                 count++;
             });
                $('#tblcomparechart').html(html);

                 var old="";
                $('#comparechart .compare').unbind().change(function (e) {


                    var code = $(this).val();


                    if (old.indexOf($(this).val()) == -1) {
                        old += code + '-';
                         $('.arrcompare').text(old);
                    console.log(old);
                    }

                });

            $('#btnCompare-kpilevel').off('click').on('click', function () {

            var value = $('.arrcompare').text().toString();
                var obj = value.substring(value.length - 1, 0);
                   var kpilevelcode = chartperiodController.getUrlParameter('kpilevelcode');
                    var period = chartperiodController.getUrlParameter('period');
                   obj = obj + '-' +kpilevelcode + ',' + period ;
                window.location.href = "/Compare/?obj=" + obj;
             })

            },
            error: function (errormessage) {
                console.log(errormessage.responseText);
            }
        });
    },
    loadDataComment() {
        $.ajax({
            url: '/ChartPeriod/LoadDataComment',
            type: "GET",
            data: {
                kpilevelcode: "@kpilevelcode@period,"+$("#user").data('userid'),
            },
            dataType: "json",
            success: function (res) {
                console.log(res);
                var data = res.data;
                var total = res.total;

                $('.total-comments').text(total);
                var html = '';
                $.each(data, function (i, item) {

                    var nowDate = new Date(parseInt(item.CommentedDate.substr(6)));
                    var date = new Date(nowDate);
                    var result = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear() + ' ' + date.getHours() + ':' + date.getMinutes() + ':' + date.getUTCSeconds();

                    html += '<div class="box-comment">';
                    html += '<img class="img-circle img-sm" src="/Content/dist/img/default-50x50.gif" alt="User Image">';
                    html += '<div class="comment-text">';
                    html += '<span class="username">';
                    html += item.FullName;
                    html += '<span class="text-muted pull-right">'+result+'</span>';
                    html += '</span>';
                    if (item.Read===true) {
                        html += item.CommentMsg
                    }
                    else {
                          html += item.CommentMsg
                    html += ' <span class="badge bg-green">new</span>';
                    }

                    html += '</div>';
                    html += '</div>';

                });
                $('#boxComments').empty();
                $('#boxComments').append(html);

            },
            error: function (err) {
                console.log(err);
            }
        });
    },
}
    </script>
}
<section id="chartperiod">
    <div class="row">
        <div class="col-md-12">
            <!-- LINE CHART -->
            <div class="box box-widget">
                <div class="box-header with-border">
                    @if (period == "W")
                    {
                        <h3 class="box-title" style="font-weight:bold">KPI Chart - @kpiname - Weekly</h3>
                    }
                    else if (period == "M")
                    {
                        <h3 class="box-title" style="font-weight:bold">KPI Chart - @kpiname - Monthly</h3>

                    }
                    else if (period == "Q")
                    {
                        <h3 class="box-title" style="font-weight:bold">KPI Chart - @kpiname - Quarterly</h3>

                    }
                    else if (period == "Y")
                    {
                        <h3 class="box-title" style="font-weight:bold">KPI Chart - @kpiname - Yearly</h3>

                    }
                    @*@if (@Session["UserName"] != null)
                        {
                            <span style="display:none" class="userid">@Session["UserID"].ToString()</span>

                        }*@

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool"><i class="fa fa-times"></i></button>

                    </div>
                </div>
                <div class="box-body">
                    <button type="button" data-toggle="modal" data-target="#modal-group" class="btn bg-navy margin btnLike pull-right" id="btnCompare"><i class="fa fa-adjust"></i> Compare</button>
                    @if (@statusfavorite == "false")
                    {
                        <button type="button" class="btn btn-info margin btnLike pull-right" id="btnLike"><i class="fa fa-heart"></i> Add Favourite</button>
                    }
                    else
                    {
                        <button type="button" class="btn btn-default  margin btnLike pull-right disabled" disabled id="btnLike"><i class="fa fa-heart"></i> Added Favourite</button>

                    }
                    <div class="form-inline" style="display:none" id="searchMonth">
                        <label class="my-1 mr-2" for="startMonth">Year</label>
                        <select class="custom-select form-control year my-1 mr-sm-2" id="monthOfYear">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1999; i <= 2099; i++)
                                {
                                    <option value="@i">Year @i</option>
                                }
                            }
                        </select>
                        <label class="my-1 mr-2" for="startMonth">Start</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="startMonth">
                            <option value="0" selected>Choose...</option>
                            <option value="1">Jan</option>
                            <option value="2">Feb</option>
                            <option value="3">Mar</option>
                            <option value="4">Apr</option>
                            <option value="5">May</option>
                            <option value="6">Jun</option>
                            <option value="7">Jul</option>
                            <option value="8">Aug</option>
                            <option value="9">Sep</option>
                            <option value="10">Oct</option>
                            <option value="11">Nov</option>
                            <option value="12">Dec</option>
                        </select>
                        <label class="my-1 mr-2" for="endMonth">End</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="endMonth">
                            <option value="0" selected>Choose...</option>
                            <option value="1">Jan</option>
                            <option value="2">Feb</option>
                            <option value="3">Mar</option>
                            <option value="4">Apr</option>
                            <option value="5">May</option>
                            <option value="6">Jun</option>
                            <option value="7">Jul</option>
                            <option value="8">Aug</option>
                            <option value="9">Sep</option>
                            <option value="10">Oct</option>
                            <option value="11">Nov</option>
                            <option value="12">Dec</option>
                        </select>
                    </div>

                    @* week *@
                    <div class="form-inline" style="display:none" id="searchWeek">
                        <label class="my-1 mr-2" for="startMonth">Year</label>
                        <select class="custom-select form-control year my-1 mr-sm-2" id="weekOfYear">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1999; i <= 2099; i++)
                                {
                                    <option value="@i">Year @i</option>
                                }
                            }
                        </select>
                        <label class="my-1 mr-2" for="startMonth">Week Start</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="startWeek">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1; i <= 52; i++)
                                {
                                    <option value="@i">Week @i</option>
                                }
                            }
                        </select>
                        <label class="my-1 mr-2" for="endMonth">Week End</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="endWeek">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1; i <= 52; i++)
                                {
                                    <option value="@i">Week @i</option>
                                }
                            }
                        </select>
                        <button type="button" class="btn bg-green margin" id="btnClearSearch"><i class="fa fa-remove"></i> Clear search</button>
                    </div>
                    @* Quarter *@
                    <div class="form-inline" style="display:none" id="searchQuarter">
                        <label class="my-1 mr-2" for="startMonth">Year</label>
                        <select class="custom-select form-control year my-1 mr-sm-2" id="quarterOfYear">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1999; i <= 2099; i++)
                                {
                                    <option value="@i">Year @i</option>
                                }
                            }
                        </select>
                        <label class="my-1 mr-2" for="startMonth">Start</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="startQuarter">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1; i <= 4; i++)
                                {
                                    <option value="@i">Quarter @i</option>
                                }
                            }
                        </select>
                        <label class="my-1 mr-2" for="endMonth">End</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="endQuarter">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 1; i <= 4; i++)
                                {
                                    <option value="@i">Quarter @i</option>
                                }
                            }
                        </select>
                    </div>
                    @* Year *@
                    <div class="form-inline" style="display:none" id="searchYear">
                        <label class="my-1 mr-2" for="startMonth">Start</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="startYear">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 2019; i <= 2050; i++)
                                {
                                    <option value="@i">Year @i</option>
                                }
                            }
                        </select>
                        <label class="my-1 mr-2" for="endMonth">End</label>
                        <select class="custom-select form-control my-1 mr-sm-2" id="endYear">
                            <option value="0" selected>Choose...</option>
                            @{
                                for (int i = 2019; i <= 2050; i++)
                                {
                                    <option value="@i">Year @i</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="chart">
                        <canvas id="lineChart" style="height:250px"></canvas>
                    </div>
                </div>
                <div class="box-footer">

                    <p class="text-green text-bold" style="font-size:16px;display:none" id="fromDateEndDate">
                        <span class="fromDayOfWeek"></span>
                        <span class="endDayOfWeek"></span>
                    </p>
                    <p class="text-green text-bold" style="font-size:16px;display:none" id="fromDateEndDateM">
                        <span class="fromDayOfMonth"></span>
                        <span class="endDayOfMonth"></span>
                    </p>
                    <p class="text-green text-bold" style="font-size:16px;display:none" id="fromDateEndDateQ">
                        <span class="fromDayOfQuarter"></span>
                        <span class="endDayOfQuarter"></span>
                    </p>
                </div>
            </div>

        </div>
        <div class="col-md-12">
            <div class="box box-widget">
                <div class="box-header with-border">
                    @if (period == "W")
                    {
                        <h3 class="box-title" style="font-weight:bold">Data  - @kpiname - Weekly</h3>
                    }
                    else if (period == "M")
                    {
                        <h3 class="box-title" style="font-weight:bold">Data - @kpiname - Monthly</h3>

                    }
                    else if (period == "Q")
                    {
                        <h3 class="box-title" style="font-weight:bold">Data - @kpiname - Quarterly</h3>

                    }
                    else if (period == "Y")
                    {
                        <h3 class="box-title" style="font-weight:bold">Data - @kpiname - Yearly</h3>

                    }

                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" style="margin-bottom:20px;" id="tblkpi">
                            <tbody>
                                <tr></tr>
                                <tr></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="box-footer"  id="textarea-remark">
                    <div class="form-group">
                        <span class="lastRemark" style="display:none"></span>
                        <label for="lastRemark" class="lastRemarkLabel"></label>
                        <textarea data-dataid="" style="font-weight:bold;color:#0094ff" class="form-control" id="lastRemark"></textarea>

                    </div>
                </div>
            </div>
        </div>
    </div>

    @RenderPage("_Modal.cshtml")
</section>